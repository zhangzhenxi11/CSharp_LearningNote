# 半导体控制系统 - 可执行应用程序

## 🚀 快速启动

### 环境要求
- .NET 6.0 或更高版本
- Windows 10/11 操作系统
- Visual Studio 2022 (推荐) 或 Visual Studio Code

### 编译和运行

#### 方法1: 使用Visual Studio
1. 双击打开 `SemiconductorControl.sln`
2. 设置 `SemiconductorControl` 为启动项目
3. 按 F5 或点击"开始调试"运行

#### 方法2: 使用命令行
```bash
# 恢复依赖包
dotnet restore

# 编译项目
dotnet build

# 运行应用程序
dotnet run --project SemiconductorControl.csproj
```

#### 方法3: 发布独立应用
```bash
# 发布为可执行文件
dotnet publish -c Release -r win-x64 --self-contained

# 生成的exe文件位于: bin\Release\net6.0-windows\win-x64\publish\
```

## 📁 项目结构

```
SemiconductorControl/
├── 📁 Aga.Diagrams/           # 图表控件库
├── 📁 Services/               # 业务服务
│   ├── DatabaseService.cs     # 数据库服务
│   ├── DeviceControlService.cs # 设备控制服务
│   ├── RecipeService.cs       # 配方管理服务
│   └── Interfaces.cs          # 服务接口定义
├── 📁 Commands/               # 命令实现
│   └── RelayCommand.cs        # MVVM命令
├── 📁 Converters/             # 数据转换器
│   └── ValueConverters.cs     # WPF值转换器
├── 📁 Data/                   # 运行时数据目录
├── 📁 Recipes/                # 配方文件目录
├── App.xaml                   # 应用程序定义
├── App.xaml.cs               # 应用程序入口
├── MainViewModel.cs          # 主视图模型
├── SemiconductorMainWindow.xaml    # 主窗口界面
├── SemiconductorMainWindow.xaml.cs # 主窗口代码
├── SemiconductorNodes.cs     # 设备节点定义
├── SemiconductorProcessController.cs # 流程控制器
├── SemiconductorStyles.xaml  # 样式资源
└── appsettings.json          # 配置文件
```

## 🎯 功能特性

### 核心功能
- ✅ **图形化流程设计**: 拖拽创建设备节点和连接
- ✅ **实时数据监控**: 设备状态和参数实时更新
- ✅ **流程控制**: 启动、停止、暂停流程执行
- ✅ **配方管理**: 保存和加载设备配置
- ✅ **数据记录**: 自动记录设备操作和数据到文件
- ✅ **日志系统**: 完整的操作日志和错误记录

### WPF技术特性展示
- 🔗 **高级数据绑定**: 双向绑定、集合绑定、多值绑定
- 📋 **MVVM架构**: 完整的Model-View-ViewModel实现
- 🎨 **自定义控件**: 半导体设备专用节点控件
- 🔄 **值转换器**: 状态到颜色、枚举到字符串等转换
- ⚡ **异步命令**: 支持async/await的ICommand实现
- 📊 **实时更新**: 基于INotifyPropertyChanged的动态UI
- 🎭 **样式和模板**: 完整的控件样式定制

## 🛠️ 使用说明

### 基本操作
1. **添加设备**: 点击左侧设备库中的按钮添加设备
2. **连接设备**: 拖拽设备端口创建连接线
3. **设置参数**: 在右侧属性面板设置设备参数
4. **启动流程**: 点击工具栏"开始流程"按钮
5. **监控状态**: 在右侧监控面板查看实时数据

### 配方管理
- **保存配方**: 文件 → 保存配置
- **加载配方**: 文件 → 打开配方
- **配方位置**: `Recipes/` 目录下的JSON文件

### 数据查看
- **实时日志**: 右下角日志面板
- **历史数据**: `Data/` 目录下的日志文件
- **数据导出**: 文件 → 导出数据

## 🔧 配置说明

### appsettings.json
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information"  // 日志级别
    }
  },
  "DeviceControl": {
    "SimulationMode": true,     // 模拟模式
    "UpdateInterval": 1000,     // 更新间隔(毫秒)
    "CommandTimeout": 5000      // 命令超时时间
  }
}
```

## 🎓 学习要点

这个应用展示了以下WPF高级特性：

### 1. 数据绑定机制
```xml
<!-- 简单属性绑定 -->
<TextBlock Text="{Binding CurrentRecipe}"/>

<!-- 双向绑定 -->
<TextBox Text="{Binding TargetValue, Mode=TwoWay}"/>

<!-- 集合绑定 -->
<ItemsControl ItemsSource="{Binding Devices}"/>

<!-- 多值绑定 -->
<TextBlock>
    <TextBlock.Text>
        <MultiBinding Converter="{StaticResource MultiValueConverter}">
            <Binding Path="DeviceName"/>
            <Binding Path="CurrentValue"/>
            <Binding Path="Unit"/>
        </MultiBinding>
    </TextBlock.Text>
</TextBlock>
```

### 2. 命令绑定
```xml
<!-- 异步命令绑定 -->
<Button Command="{Binding StartProcessCommand}" 
        Content="开始流程"/>

<!-- 带参数的命令 -->
<Button Command="{Binding AddDeviceCommand}" 
        CommandParameter="Pump"/>
```

### 3. 值转换器
```xml
<!-- 枚举到颜色转换 -->
<Ellipse Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}"/>

<!-- 布尔到可见性转换 -->
<Grid Visibility="{Binding HasSelectedDevice, Converter={StaticResource BoolToVisibilityConverter}}"/>
```

### 4. MVVM模式
- **Model**: `SemiconductorDevice`, `ProcessConnection`
- **View**: `SemiconductorMainWindow.xaml`
- **ViewModel**: `MainViewModel`

## 🚀 扩展建议

1. **集成真实设备驱动**: 替换`DeviceControlService`模拟实现
2. **添加数据库支持**: 使用Entity Framework集成SQL Server
3. **网络通信**: 添加TCP/IP或OPC UA通信
4. **报表功能**: 集成报表生成和打印功能
5. **用户权限**: 添加用户登录和权限管理

## ⚠️ 注意事项

- 首次运行会自动创建示例配方和数据目录
- 所有数据以JSON格式存储在本地文件中
- 设备控制采用模拟模式，可在配置中修改
- 建议在开发环境中测试后再部署到生产环境

## 📞 技术支持

如有问题，请检查：
1. .NET 6.0 运行时是否正确安装
2. 项目依赖包是否完整恢复
3. 日志文件中的错误信息
4. Visual Studio输出窗口的编译信息