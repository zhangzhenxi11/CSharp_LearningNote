# Aga.Diagrams 移植到 FcdControlSystem 项目配置指南

## 问题原因分析

根据错误信息，主要问题包括：
1. **多目标框架冲突**：项目同时配置了 .NET Framework 4.8、.NET 6.0 和 .NET 8.0
2. **AssemblyInfo 重复生成**：自动生成的程序集信息与手动 AssemblyInfo.cs 冲突
3. **项目配置不一致**：不同项目使用了不同的目标框架版本

## 解决步骤

### 1. FcdControlSystem 主项目配置 (FcdControlSystem.csproj)
```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net8.0-windows</TargetFramework>
    <UseWPF>true</UseWPF>
    <AssemblyName>FcdControlSystem</AssemblyName>
    <RootNamespace>FcdControlSystem</RootNamespace>
    <!-- 关键：禁用自动生成 AssemblyInfo -->
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="Aga.Diagrams\Aga.Diagrams.csproj" />
  </ItemGroup>

</Project>
```

### 2. Aga.Diagrams 项目配置 (Aga.Diagrams.csproj)
```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net8.0-windows</TargetFramework>
    <UseWPF>true</UseWPF>
    <AssemblyName>Aga.Diagrams</AssemblyName>
    <RootNamespace>Aga.Diagrams</RootNamespace>
    <!-- 关键：禁用自动生成 AssemblyInfo -->
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

</Project>
```

### 3. 清理操作
在修改配置后，执行以下清理操作：

```powershell
# 删除所有 bin 和 obj 文件夹
Remove-Item -Recurse -Force .\bin\
Remove-Item -Recurse -Force .\obj\
Remove-Item -Recurse -Force .\Aga.Diagrams\bin\
Remove-Item -Recurse -Force .\Aga.Diagrams\obj\

# 清理解决方案
dotnet clean

# 重新还原和构建
dotnet restore
dotnet build
```

## 核心配置说明

### GenerateAssemblyInfo 属性
这是解决特性重复错误的关键配置：
- `<GenerateAssemblyInfo>false</GenerateAssemblyInfo>`：禁用自动生成程序集信息
- 当项目中已存在 AssemblyInfo.cs 文件时，必须设置此属性为 false

### 目标框架统一
- 所有相关项目应使用相同的目标框架版本
- 推荐使用 `net8.0-windows` 以获得最新特性和性能

### WPF 项目特殊配置
- `<UseWPF>true</UseWPF>`：启用 WPF 支持
- `<OutputType>WinExe</OutputType>`：指定输出类型为 Windows 可执行文件（仅主项目需要）

## 学习要点

### 1. .NET 项目系统理解
- **SDK 风格项目**：使用 `<Project Sdk="Microsoft.NET.Sdk">` 的现代项目格式
- **自动生成功能**：现代项目会自动生成 AssemblyInfo，需要正确配置避免冲突

### 2. 程序集信息管理
- **手动 AssemblyInfo.cs**：传统方式，包含版本、公司等信息
- **自动生成**：基于项目属性自动生成，更现代的方式
- **冲突处理**：两者不能同时使用，需要通过 GenerateAssemblyInfo 控制

### 3. 项目依赖管理
- **ProjectReference**：项目间引用的正确方式
- **版本一致性**：所有相关项目应使用相同的目标框架

## 移植最佳实践

1. **渐进式移植**：先确保基础库能编译，再逐步添加功能
2. **配置统一**：确保所有项目使用相同的目标框架和配置
3. **依赖管理**：明确项目间的依赖关系
4. **测试验证**：每个步骤后都进行编译验证

## 后续优化建议

1. **代码注释**：根据您的学习偏好，为移植的代码添加详细中文注释
2. **WPF Binding 学习**：研究 Aga.Diagrams 中的数据绑定实现
3. **架构理解**：分析库的设计模式和架构思路